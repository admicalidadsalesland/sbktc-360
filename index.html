<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suma de Indicadores - Evaluaciones</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      align-items: center;
    }
    .search-box input {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      flex: 1;
    }
    .search-box button {
      padding: 10px 20px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    .search-box button:hover {
      background: #2980b9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
    }
    th, td {
      border: 1px solid #eee;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #f0f4f8;
      color: #2c3e50;
    }
    td {
      font-weight: 500;
    }
    .metric-name {
      font-weight: 600;
      color: #2980b9;
      text-align: left;
    }
    .error {
      color: #e74c3c;
      text-align: center;
      font-weight: bold;
      margin: 20px 0;
    }
    .info {
      text-align: center;
      font-style: italic;
      color: #7f8c8d;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìã Suma de Indicadores por DNI</h1>

    <div class="search-box">
      <input type="text" id="dniInput" placeholder="Buscar por DNI (ej: 40753375)" />
      <button onclick="searchByDNI()">Buscar</button>
    </div>

    <div id="resultContainer">
      <div class="info">Cargando datos...</div>
    </div>
  </div>

  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRp7iRBUwVpHnmf7Q0mLyARIBl-inFlZbH43i3wU1whcjE0GlPi7Z51VcmXRsWrcYCmWMS1WTL-ySJt/pub?gid=2119161122&single=true&output=csv';

    const NEW_COLUMNS = [
      "1.1 PROTOCOLO DE BIENVENIDA Y DESPEDIDA",
      "1.2 CAPACIDAD DE FLUIDEZ Y VOCALIZACI√ìN",
      "1.3 PRESENTA SONRISA TELEFONICA",
      "1.4 NO UTILIZA TECNISISMOS",
      "1.5 NO UTILIZA MULETILLAS",
      "1.6 ESCUCHA ACTIVA",
      "1.7 NO REALIZA TUTEO (PERSONALIZACION)",
      "2.1 BRINDA CARACTERISTICAS CORRECTAS DEL PRODUCTO",
      "2.2 BRINDA CARACTERISTICAS COMPLETAS DEL PRODUCTO",
      "2.3 PRESENTA BENEFICIOS DE MANERA CORRECTA",
      "2.4 PRESENTA BENEFICIOS DE MANERA COMPLETA",
      "2.5 ACLARA DUDAS DEL CLIENTE",
      "3.1 SONDEA LA NECESIDAD DE CLIENTE",
      "3.2 REBATE LA NEGATIVA DEL CLIENTE",
      "3.3 REBATE DE ACUERDO A LA NEGATIVA DEL CLIENTE",
      "3.4 APLICA CIERRE DE VENTA",
      "3.5 OFRECE CORRECTAMENTE CUENTA DIGITAL",
      "3.6 TIPIFICACI√ìN",
      "4.1 LPDP (FLAG 0 & 2)"
    ];

    let allData = [];

    async function loadData() {
      try {
        const response = await fetch(CSV_URL);
        const csvText = await response.text();
        const lines = csvText.trim().split("\n");
        const headers = lines[0].split(",").map(h => h.trim());
        allData = [];

        for (let i = 1; i < lines.length; i++) {
          const values = lines[i].split(",").map(v => v.trim().replace(/^"(.*)"$/, '$1'));
          const row = {};
          headers.forEach((h, idx) => (row[h] = values[idx]));
          allData.push(row);
        }

        document.getElementById("resultContainer").innerHTML =
          `<div class="info">‚úÖ Datos cargados. Ingresa un DNI para buscar.</div>`;
      } catch (error) {
        showError("‚ùå Error al cargar CSV: " + error.message);
      }
    }

    function searchByDNI() {
      const dni = document.getElementById("dniInput").value.trim();
      if (!dni) {
        alert("Por favor ingresa un DNI.");
        return;
      }

      const filtered = allData.filter(r => r.DNI && r.DNI.includes(dni));
      if (filtered.length === 0) {
        showError(`‚ùå No se encontraron registros con DNI ${dni}`);
        return;
      }

      let resultHTML = `<h2 style="text-align:center; color:#2c3e50;">Resultados para DNI: ${dni}</h2>`;
      resultHTML += `<table><thead><tr><th>Indicador</th><th>Suma Total</th></tr></thead><tbody>`;

      NEW_COLUMNS.forEach(col => {
        let total = 0;
        filtered.forEach(row => {
          let val = row[col];
          if (val && !isNaN(val)) total += parseFloat(val);
        });
        resultHTML += `<tr><td class="metric-name">${col}</td><td>${total.toFixed(1)}</td></tr>`;
      });

      resultHTML += `</tbody></table>`;
      document.getElementById("resultContainer").innerHTML = resultHTML;
    }

    function showError(msg) {
      document.getElementById("resultContainer").innerHTML =
        `<div class="error">${msg}</div>`;
    }

    loadData();
  </script>
</body>
</html>
